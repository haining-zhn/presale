$.fn.extend({svgLine:function(t){var r=window.svgLineCount?window.svgLineCount:window.svgLineCount=0;r=++window.svgLineCount;var h=t.onSelect||function(){},n=t.onCancle||function(){};var q=function(N,i){try{h(N,i)}catch(O){console.error(O)}},u=function(N,i){try{n(N,i)}catch(O){console.error(O)}};var b=t.size||"sm";var D=t.removAble;var p=t.skin||"green";if(["sm","md","lg"].indexOf(b)===-1){b="sm"}$(this).empty();function z(N,i){return N==null||N===""?i:N}var H=t.leftList,o=t.headerLeft;var j=t.rightList,f=t.headerRight;var l="500px",v=t.mapping||{};var m=z(t.key,"key"),a=z(t.width,l);var k=z(t.name,"name");var J=".lt-tr[sid="+r+"] ";function E(i){return $(J+"."+i)}function C(N,i){return $(J+"."+N+" li[key='"+i+"']")}$(this).append('<div style="'+(t.width?"width:"+a:"")+";min-width:"+l+'"><div sid="'+r+'" class="lt-tr '+b+" "+p+'"><div class="list-box left"><div class="list-header">'+o+'</div><ul class="lul"></ul></div><div class="list-box right"><div class="list-header">'+f+'</div><ul class="rul"></ul></div></div><svg sid="'+r+'" xmlns="http://www.w3.org/2000/svg" version="1.1" style=""></svg></div>');var G,g=null;function y(){L();for(var i in v){B(i,v[i])}}var e=0,d=0;function L(){var T=E("left");var R=E("right");var P=T.offset().left+T.outerWidth(),O=R.offset().left;var S=T.offset().top,Q=R.offset().top;var N,i;N=(P>=O)?0:O-P;if(S<=Q){i=Q-S+R.outerHeight()}else{i=S-Q+T.outerHeight()}$("svg[sid="+r+"]").width(N).height(i);return{}}function s(N,i){var P=N==null?false:C("lul",N).hasClass("disabled");var O=i==null?false:C("rul",i).hasClass("disabled");return !(P||O)}function w(){if($(this).hasClass("disabled")){return}var N=$(this).attr("key");var i=$(this).parent().hasClass("lul");var P=F(N,i);if(P!==false){if(!s(P[0],P[1])){return}x(P[0]);if(P[0]!=="drea_temp_mark"&&P[1]!=="drea_temp_mark"){u(P[0],P[1])}}if(i){if($(this).hasClass("active")){C("lul",G).removeClass("active");G=null}else{if(G!=null){C("lul",G).removeClass("active");x("drea_temp_mark");$("line[id*=drea_temp_mark]").remove()}G=N;C("lul",G).addClass("active");v[N]="drea_temp_mark"}}else{if($(this).hasClass("active")){C("rul",g).removeClass("active");g=null}else{if(g!=null){C("rul",g).removeClass("active");x("drea_temp_mark");$("line[id*=drea_temp_mark]").remove()}g=N;C("rul",g).addClass("active");v["drea_temp_mark"]=N}}if(G!=null&&g!=null){B(G,g);x("drea_temp_mark");$("line[id*=drea_temp_mark]").remove();C("lul",G).addClass("active");C("rul",g).addClass("active");if(G!=="drea_temp_mark"&&g!=="drea_temp_mark"){try{q(G,g)}catch(O){console.error(O)}}G=g=null}}function x(Q){for(var i in v){var P=v[i];var O=Q===i,N=v[i]===Q;if(O||N){delete v[i];A(i,P);return[i,P]}}return null}function A(i,N){$("svg[sid="+r+"] #line_"+r+"_"+i+"_"+N).remove();$("svg[sid="+r+"] #line_"+r+"_"+i+"_"+N+"_l").remove();$("svg[sid="+r+"] #line_"+r+"_"+i+"_"+N+"_r").remove();C("lul",i).removeClass("active");C("rul",N).removeClass("active")}function F(O,N){for(var i in v){if((N&&O===i)||(!N&&v[i]===O)){return[i,v[i]]}}return false}function K(P,R){var T=z(R[k],R[m]);var Q=R.icon||"";if(Q!==""){Q="<i class='"+Q+"'></i>"}var N=!!R.disable;var i=R.removable!==undefined?R.removable:D!==false;var O="<span>"+Q+T+"</span>";var S=$("<li key='"+R[m]+"' title='"+T+"'"+(N?" class='disabled'":"")+"><div>"+O+"</div></li>").appendTo($(P)).click(w).mousemove(function(aa){var V=$(aa.target);if(V.is("span")){V=V.parent().parent()}var X=V.parent().hasClass("lul");var W=G==null;var U=g==null;var Z=E("left");var Y=E("right");if(X&&W&&!U){e=0,d=V.offset().top-Z.offset().top+V.outerHeight()/2;M("drea_temp_mark",g)}if(!X&&!W&&U){e=$("svg[sid="+r+"]").width(),d=V.offset().top-Z.offset().top+V.outerHeight()/2;M(G,"drea_temp_mark")}});if(i){$('<span class="close">Ã—</span>').click(function(){if(G==null&&g==null){var V=$(this).parent().parent();var X=V.attr("key");var U=V.parent().hasClass("lul");var Z=F(X,U);var Y,W;if(Z!==false){if(!s(Z[0],Z[1])){return}delete v[Z[0]];A(Z[0],Z[1]);C(U?"lul":"rul",X).remove();u(Z[0],Z[1])}else{if(U&&!s(X,null)){return}if(!U&&!s(null,X)){return}C(U?"lul":"rul",X).remove()}y()}}).appendTo(S.children("div"))}}$(document).bind("mousedown",function(N){var i=$(N.target);if(!i.is("li[key]")&&!i.is("li[key] div")&&!i.is("li[key] i")&&!i.is("li[key] span")&&!i.is("line:not([id*=drea_temp_mark])")){if(G!=null){C("lul",G).removeClass("active")}if(g!=null){C("rul",g).removeClass("active")}x("drea_temp_mark");$("line[id*=drea_temp_mark]").remove();G=null;g=null}});function B(af,ad){if(af==="drea_temp_mark"||ad==="drea_temp_mark"){return}var T=E("left");var al=E("right");var Z=$("svg[sid="+r+"]");var W=C("lul",af);var V=C("rul",ad);W.addClass("active");V.addClass("active");var ak=W.offset().left,aj=V.offset().left;var R=W.offset().top,Q=V.offset().top;var ab="line_"+r+"_"+af+"_"+ad;var ah=ab+"_l",U=ab+"_r";var X=$("svg[sid="+r+"] #"+ab);var aa=$("svg[sid="+r+"] #"+ah);var Y=$("svg[sid="+r+"] #"+U);if(X.length==0){X=$(c("line",ab));X.click(function(){if(!s(af,ad)){return}delete v[af];A(af,ad);
u(af,ad);if(G!=null){v[G]=ad;q(G,ad);G=g=null}else{if(g!=null){v[af]=g;q(af,g);G=g=null}}x("drea_temp_mark");$("line[id*=drea_temp_mark]").remove();y()});aa=$(c("circle",ah));Y=$(c("circle",U));Z.append(X).append(aa).append(Y);v[af]=ad}var N=0,i=Z.width();var P=R-Z.offset().top+W.outerHeight()/2;var O=Q-Z.offset().top+V.outerHeight()/2;var S=30,ai,ac;if(T.offset().top<al.offset().top){ai=S;ac=al.offset().top-T.offset().top+S}else{ai=T.offset().top-al.offset().top+S;ac=S}var ag=false,ae=false;if(P<=ai){P=ai,ag=true}if(P>ai+T.outerHeight()-S){P=ai+T.outerHeight()-S,ag=true}if(O<=ac){O=ac,ae=true}if(O>ac+al.outerHeight()-S){O=ac+al.outerHeight()-S,ae=true}X.attr("x1",N).attr("x2",i).attr("y1",P).attr("y2",O);if(ag){aa.hide()}else{aa.show()}if(ae){Y.hide()}else{Y.show()}aa.attr("cx",N).attr("cy",P).attr("r",5);Y.attr("cx",i).attr("cy",O).attr("r",5)}function M(ad,ac){var ai=ad==="drea_temp_mark";var V=E("left");var ah=E("right");var Z=$("svg[sid="+r+"]");var X=C("lul",ad);var W=C("rul",ac);var aj=ai?W.outerHeight()/2:X.outerHeight()/2;X.addClass("active");W.addClass("active");var S=Z.offset().top;var O=Z.offset().top;var ag=ai?e:X.offset().left;var af=ai?W.offset().left:e;var T=ai?d:X.offset().top;var R=ai?W.offset().top:d;var aa="line_"+r+"_"+ad+"_"+ac;var Y=$("svg[sid="+r+"] #"+aa);if(Y.length==0){Y=$(c("line",aa));Z.append(Y)}var N=ai?e+1:0;var i=ai?Z.width():e-2;var Q=ai?d:T-Z.offset().top+aj;var P=ai?R-Z.offset().top+aj:d;var U=30;var ae,ab;if(V.offset().top<ah.offset().top){ae=U;ab=ah.offset().top-V.offset().top+U}else{ae=V.offset().top-ah.offset().top+U;ab=U}if(Q<=ae){Q=ae}if(Q>ae+V.outerHeight()-U){Q=ae+V.outerHeight()-U}if(P<=ab){P=ab}if(P>ab+ah.outerHeight()-U){P=ab+ah.outerHeight()-U}Y.attr("x1",N).attr("x2",i).attr("y1",Q).attr("y2",P)}function c(i,P){var O="http://www.w3.org/2000/svg";var N=document.createElementNS(O,i);N.setAttribute("class","draw-line");N.setAttribute("id",P);return N}$(J+".lul").bind("scroll",y);$(J+".rul").bind("scroll",y);for(var I=0;I<H.length;I++){K(J+".lul",H[I])}for(var I=0;I<j.length;I++){K(J+".rul",j[I])}y();$(window).resize(y);$("svg[sid="+r+"]").bind("mousemove",function(O){e=O.offsetX;d=O.offsetY;var N=G==null?"drea_temp_mark":G;var i=g==null?"drea_temp_mark":g;if(G!=null&&g==null||G==null&&g!=null){M(N,i)}});return{getData:function(){return v},setData:function(i){v=i;$(".lt-tr[sid="+r+"] li[key]").removeClass("active");$("svg[sid="+r+"]").empty();y()},resize:function(i){if(i){$(".lt-tr[sid="+r+"]").parent().width(i)}y()},refresh:y,addOptions:function(Q){if(Q){var O=Q.leftList;var N=Q.rightList;var R=[];$(J+".lul li").each(function(S,T){R.push($(T).attr("key"))});if(O){for(var P in O){if(R.indexOf(O[P][m])===-1){K(J+".lul",O[P])}}}if(N){for(var P in N){if(R.indexOf(N[P][m])===-1){K(J+".rul",N[P])}}}}},deleteOptions:function(R){if(R){var P=R.leftList;var N=R.rightList;if(P){for(var Q in P){var O=v[P[Q]];if(O){delete v[P[Q]];A(P[Q],O)}$(J+".lul li[key='"+P[Q]+"']").remove()}}if(N){var S={};for(var T in v){S[v[T]]=T}for(var Q in N){var O=S[N[Q]];if(O){delete v[O];A(O,N[Q]);$(J+".rul li[key='"+N[Q]+"']").remove()}}}}},getUl:function(){return{left:$(J+".lul"),right:$(J+".rul")}}}}});